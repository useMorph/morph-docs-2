---
title: "PostgreSQL"
icon: "database"
---

## PostgreSQL ã«æ¥ç¶šã™ã‚‹

<Tabs>
  <Tab title="ã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆ">
    <Steps>
      <Step title="SQL Connectionã‚’ä½œæˆã™ã‚‹">
        ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ã€ŒDataã€ã‚¿ãƒ–ã‹ã‚‰SQL Connectionã‚’é¸æŠã— ã€ŒCreateã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¾ã™ã€‚
        <img src="/assets/images/docs/connect-data-platform-connection.png" alt="Connection" />
      </Step>

      <Step title="PostgreSQLã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹">
        è¡¨ç¤ºã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ã«æ¥ç¶šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
        ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§æ¥ç¶šã™ã‚‹å ´åˆã¯ã€ŒSSHã€ã®æ¬„ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œä»»æ„ã®é …ç›®ã‚‚å…¥åŠ›ã—ã¾ã™ã€‚

        å…¥åŠ›å¾ŒCreateãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ä½œæˆãŒå®Œäº†ã—ã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä¸å‚™ãŒã‚ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚æ¥ç¶šå†…å®¹ãŒæ­£ã—ã„ã‹å†åº¦ã”ç¢ºèªãã ã•ã„ã€‚
        <img src="/assets/images/docs/connect-data-platform-postgresql-create.png" alt="PostgreSQL Connection Create" />

        | é …ç›®å            | èª¬æ˜                                      | å¿…é ˆ  | ä¾‹                            |
        |-------------------|-------------------------------------------|-------|-------------------------------|
        | `Host`           | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ›ã‚¹ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚      | âœ…    | `example.com`                |
        | `Port`           | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šãƒãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¾ã™ã€‚    | âœ…    | `5432`                       |
        | `Database`       | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’å…¥åŠ›ã—ã¾ã™ã€‚              | âœ…    | `my_database`                |
        | `Username`       | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¾ã™ã€‚    | âœ…    | `db_user`                    |
        | `Password`       | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ | âœ…    | `mypassword`                 |
        | `SSH`            | SSHæ¥ç¶šã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«æŒ‡å®šã—ã¾ã™ã€‚        |       |                               |
        | `SSH Host`       | ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã®ãƒ›ã‚¹ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚  |     | `ssh.example.com`            |
        | `SSH Port`       | ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã®æ¥ç¶šãƒãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¾ã™ã€‚|     | `22`                         |
        | `SSH Username`   | ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¾ã™ã€‚|     | `ssh_user`                   |
        | `SSH Password`   | ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ |     | `sshpassword`                |
        | `SSH Private Key`| ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã®ç§˜å¯†éµã‚’å…¥åŠ›ã—ã¾ã™ã€‚    |     | `-----BEGIN RSA PRIVATE KEY-----` |
        | `SSH Passphrase` | ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã®ç§˜å¯†éµã®ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’å…¥åŠ›ã—ã¾ã™ã€‚ |     | `my_passphrase`              |


        <Warning>æ¥ç¶šå…ˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® IP ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«å¿…ãš`54.150.149.0/32`ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚</Warning>

      </Step>
      <Step title="ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹">
        ä½œæˆãŒæˆåŠŸã™ã‚‹ã¨ä¸€è¦§è¡¨ç¤ºã‹ã‚‰ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³åã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¢ã‚¤ã‚³ãƒ³æ¨ªã®æ–‡å­—åˆ—ãŒ`connection_name`ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚³ãƒ¼ãƒ‰ä¸Šã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šå¯èƒ½ã§ã™ã€‚

        <img src="/assets/images/docs/connect-data-platform-postgresql-complete.png" alt="PostgreSQL Connection Create Complete" />

        SQLã¾ãŸã¯Pythonã®ã‚³ãƒ¼ãƒ‰ã«ä½œæˆã—ãŸã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ã—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
        <CodeGroup>
        ```sql SQL
        {{
            config(
                connection="connection_name"
            )
        }}

        select * from table_name
        ```

        ```python Python
        import morph
        from morph import MorphGlobalContext
        from morph_lib.database import execute_sql


        @morph.func
        def main(context: MorphGlobalContext):
            df = execute_sql(
                sql="SELECT * from table_name"
                connection="connection_name"
            )
            return df
        ```
        </CodeGroup>
      </Step>
    </Steps>

  </Tab>
  <Tab title="ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆ">
    <Steps>
      <Step title="morph initã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹">
        `morph init`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦DBã®æ¥ç¶šæƒ…å ±ã‚’`~/.morph/connections.yml`ã«ä¿å­˜ã—ã¾ã™ã€‚
        ```bash Shell
        morph init
        ```

        <Warning>
        morphãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œãªã£ã¦ã„ãªã„å ´åˆã¯äº‹å‰ã«ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‹ã‚‰ãŠé€²ã¿ãã ã•ã„ã€‚
        ```bash shell
        pip install morph-data
        ```
        </Warning>

        å¯¾è©±å¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã©ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹ã‹èã‹ã‚Œã‚‹ã®ã§PostgreSQLã‚’é¸æŠã—ã¾ã™ã€‚
        ```bash Shell
        Select your database type:
        1. PostgreSQL
        2. MySQL
        3. Redshift
        4. SQLServer
        5. Snowflake (User/Password)
        6. BigQuery (Service Account)
        Enter the number corresponding to your database type: 1

        PostgreSQL selected.
        ```

        ç¶šã„ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚`slug`ã¯ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³åã¨ã—ã¦æ‰±ã†ã‚‚ã®ã§ã€ã“ã®åå‰ã‚’SQLã‚‚ã—ãã¯Pythonã§æŒ‡å®šã—ã¾ã™ã€‚

        ä»¥ä¸‹ã®å…¥åŠ›ä¾‹ã¯å®Ÿéš›ã«æ¥ç¶šã§ãã‚‹å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
        ```bash shell
        Create a slug for your connection: postgresql-connection
        Enter your PostgreSQL host (default: localhost): localhost
        Enter your PostgreSQL username: your_user_name
        Enter your PostgreSQL password: your_password
        Enter your PostgreSQL port (default: 5432): 5432
        Enter your PostgreSQL database name: your_database_name
        Enter your PostgreSQL schema name (default: public): public
        Select if you are using SSH tunneling (y/n): n
        ```

        èªè¨¼æƒ…å ±ã®ä¿å­˜ãŒå®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        ```bash shell
        Successfully initialized! ğŸ‰
        You can edit your connection details in `path_to_connections.yml`
        ```

        `connections.yml`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»–ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸå ´åˆã¯`connections`ä»¥ä¸‹ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚
        ```bash shell
        cat ~/.morph/connections.yml
        ```

        ```yaml
        connections:
          postgresql-connection: # ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³å
            dbname: your_database_name
            host: localhost
            password: your_password
            port: 5432
            schema_: public
            ssh_host: null
            ssh_password: null
            ssh_port: null
            ssh_private_key: null
            ssh_user: null
            type: postgres
            user: your_user_name
        ```
      </Step>
      <Step title="ã‚³ãƒ¼ãƒ‰ä¸Šã§ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹">
        SQLã¾ãŸã¯Pythonã®ã‚³ãƒ¼ãƒ‰ã«ä½œæˆã—ãŸã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ã—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
        <CodeGroup>
        ```sql SQL
        {{
            config(
                connection="connection_name"
            )
        }}

        select * from table_name
        ```

        ```python Python
        import morph
        from morph import MorphGlobalContext
        from morph_lib.database import execute_sql


        @morph.func
        def main(context: MorphGlobalContext):
            df = execute_sql(
                sql="SELECT * from table_name"
                connection="connection_name"
            )
            return df
        ```
        </CodeGroup>
      </Step>
    </Steps>

  </Tab>  
</Tabs>
